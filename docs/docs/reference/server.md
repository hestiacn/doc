# 服务器系列命令介绍

## v-list-sys-disk-status

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-disk-status)

### 脚本概述

`v-list-sys-disk-status` 是一个 Hestia CLI 命令脚本，用于列出系统磁盘的相关信息。该脚本通过运行不同的命令来获取磁盘的使用情况、索引节点使用情况、I/O 使用情况以及磁盘的总体信息，并将这些信息以可读的方式输出给用户。

### 使用方法

#### 基本语法

```bash
v-list-sys-disk-status
```

直接运行脚本即可获取磁盘的相关信息。

### 工作原理

脚本执行时会依次执行以下命令，并将结果输出到终端。

1. **显示磁盘使用情况**

使用 `df -h` 命令来显示磁盘的使用情况，包括每个挂载点的总空间、已用空间、可用空间和使用率。输出以人类可读的格式（例如 GB、MB）显示。

2. **显示索引节点使用情况**

使用 `df -ih` 命令来显示索引节点的使用情况。索引节点（inode）是文件系统中的一种数据结构，用于存储文件的元数据。这个命令可以帮助用户了解索引节点的使用情况，以避免因索引节点耗尽而导致的问题。

3. **显示I/O使用情况**

使用 `iostat -m` 命令来显示磁盘的I/O使用情况。这个命令提供了关于磁盘读写操作的统计信息，包括传输速率、IOPS（每秒输入/输出操作数）以及磁盘利用率等，有助于用户了解磁盘的性能表现。

4. **显示磁盘信息**

使用 `fdisk -l` 命令来列出系统中所有磁盘的详细信息。这个命令会输出每个磁盘的分区表、大小、类型等信息，帮助用户了解磁盘的整体布局和配置。

### 示例

#### 示例一：磁盘使用情况和索引节点使用情况

运行脚本后，首先会输出磁盘的使用情况：

```bash
$ v-list-sys-disk-status
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1        50G   10G   37G  22% /
udev            3.9G     0  3.9G   0% /dev
tmpfs           798M  1.7M  796M   1% /run
...
```

紧接着会输出索引节点的使用情况：

```bash
Filesystem       Inodes IUsed IFree IUse% Mounted on
/dev/sda1       3276800 60113 3216687    2% /
udev            1002721   521 1002199    1% /dev
tmpfs           1017240   516 1016724    1% /run
...
```

#### 示例二：I/O使用情况和磁盘信息

接下来，脚本会输出I/O使用情况：

```bash
$ v-list-sys-disk-status
...
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.35    0.00    0.29    0.03    0.00   99.33
Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await svctm  util
sda               0.00     0.60    0.30    0.40     2.64     5.76    28.80     0.00    3.57    3.17    4.10   0.50   0.05
...
```

最后，脚本会列出磁盘信息：

```bash
$ v-list-sys-disk-status
...
Disk /dev/sda: 500.1 GB, 500107862016 bytes
255 heads, 63 sectors/track, 60801 cylinders, total 976773168 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disk identifier: 0x00000000

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *       2048      976771071   488385526   83  Linux
...
```

### 注意事项

- 脚本需要相应的命令（如 `df`、`iostat`、`fdisk`）在系统上可用才能正确执行。
- `iostat` 命令可能不在所有 Linux 发行版中都默认安装，可能需要用户手动安装 `sysstat` 包。
- 输出信息可能因系统和磁盘配置的不同而有所差异。

### 脚本退出

脚本执行完成后会正常退出，返回值为 0 表示执行成功。如果执行过程中发生错误，返回值可能不为 0。

### 总结

`v-list-sys-disk-status` 脚本通过一系列命令的组合，为用户提供了磁盘使用情况、索引节点使用情况、I/O 使用情况以及磁盘信息的全面展示。这对于系统管理员和运维人员来说是非常有用的工具，能够帮助他们快速了解系统磁盘的状态和性能。

## v-get-sys-timezone

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-get-sys-timezone)

### 脚本概述

`v-get-sys-timezones` 是一个 Hestia CLI 命令脚本，用于获取系统时区信息。该脚本通过检查不同的系统文件来确定当前系统的时区设置，并输出相应的时区信息。

### 使用方法

#### 基本语法

```bash
v-get-sys-timezones
```

该脚本不需要任何参数，直接运行即可输出当前系统的时区设置。

### 工作原理

脚本首先会检查不同系统上的时区配置文件，以确定当前系统的时区设置。

1. **RHEL/CentOS**: 脚本会检查 `/etc/sysconfig/clock` 文件是否存在，并尝试从中读取时区信息。

2. **Debian/Ubuntu**: 如果 `/etc/sysconfig/clock` 不存在，脚本会检查 `/etc/timezone` 文件，并读取其中的时区信息。

3. **符号链接**: 如果以上两个文件都不存在，脚本会检查 `/etc/localtime` 是否为符号链接。如果是，则通过解析符号链接的目标路径来获取时区信息。

4. **zoneinfo 解析**: 如果以上方法都失败，脚本会尝试通过比较 `/etc/localtime` 的 MD5 校验和与 `/usr/share/zoneinfo/` 目录下的时区文件的 MD5 校验和来确定时区。这是一种较为缓慢的方法，但通常能够获取到正确的时区信息。

### 示例

#### 示例一：RHEL/CentOS 系统

假设 `/etc/sysconfig/clock` 文件存在，内容如下：

```bash
ZONE="Asia/Shanghai"
UTC=false
ARC=false
```

运行脚本：

```bash
$ v-get-sys-timezones
Asia/Shanghai
```

脚本输出结果为 `Asia/Shanghai`，即当前系统的时区设置为上海时区。

#### 示例二：Debian/Ubuntu 系统

假设 `/etc/timezone` 文件存在，内容为 `Asia/Shanghai`。

运行脚本：

```bash
$ v-get-sys-timezones
Asia/Shanghai
```

脚本输出结果为 `Asia/Shanghai`，表示当前系统的时区设置为上海时区。

#### 示例三：符号链接

如果 `/etc/localtime` 是一个指向 `/usr/share/zoneinfo/Asia/Shanghai` 的符号链接，脚本会解析该链接并输出相应的时区信息。

运行脚本：

```bash
$ v-get-sys-timezones
Asia/Shanghai
```

#### 示例四：zoneinfo 解析

如果以上方法都不适用，脚本会尝试通过比较 MD5 校验和来确定时区。这可能需要一些时间，但最终会输出正确的时区信息。

### 注意事项

- 脚本运行前，请确保相关配置文件和时区文件存在于正确的路径下。
- 在不同的 Linux 发行版中，时区配置文件的位置和命名可能有所不同。脚本已经尽可能覆盖了常见的配置方式，但可能无法适用于所有情况。

### 总结

`v-get-sys-timezones` 脚本提供了一个简单而有效的方法来获取当前系统的时区设置。通过检查不同的系统文件和符号链接，脚本能够适配不同的 Linux 发行版，并输出正确的时区信息。无论是在 RHEL/CentOS、Debian/Ubuntu 还是其他系统上，都可以使用该脚本来获取时区设置，方便用户进行时间相关的操作。

## v-get-sys-timezones

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-get-sys-timezones)

### 脚本概述

`v-get-sys-timezones` 是一个 Hestia CLI 命令脚本，用于列出系统时区信息。脚本允许用户通过指定格式选项来定制输出格式。

### 使用方法

#### 基本语法

```bash
v-get-sys-timezones [FORMAT]
```

#### 参数

- `[FORMAT]`：指定输出格式。可选值包括 `json`、`plain` 和默认的 `shell`。如果不指定，将使用默认格式 `shell`。

### 示例

#### 示例一：默认格式（shell）

```bash
$ v-get-sys-timezones
Timezone
--------
Asia/Shanghai
Europe/Berlin
...
```

在默认格式下，脚本将输出一个格式化的时区列表，包括标题和各个时区。

#### 示例二：JSON 格式

```bash
$ v-get-sys-timezones json
[
  "Asia/Shanghai",
  "Europe/Berlin",
  ...
]
```

通过指定 `json` 格式，脚本将输出一个 JSON 格式的时区列表，这对于与其他系统或脚本交互时特别有用。

#### 示例三：纯文本格式（plain）

```bash
$ v-get-sys-timezones plain
Asia/Shanghai
Europe/Berlin
...
```

在纯文本格式下，脚本将仅输出时区名称，不含任何格式化信息，这适合需要简单文本列表的场景。

### 脚本工作原理

脚本通过解析 `/usr/share/zoneinfo/posix` 目录下的时区文件来获取系统时区列表。根据用户指定的格式，脚本将调用不同的函数来处理并输出时区信息。

- `json_list` 函数：将时区列表转换为 JSON 格式输出。
- `shell_list` 函数：将时区列表格式化为带标题的 shell 表格输出。
- `plain_list` 函数：直接输出时区列表，不含任何格式化。

### 注意事项

- 请确保在运行脚本之前已经正确设置了 Hestia 的配置文件和相关的环境变量。
- 根据系统配置和安装路径的不同，时区文件的路径可能有所差异。本示例假设时区文件位于 `/usr/share/zoneinfo/posix` 目录下。

### 总结

`v-get-sys-timezones` 脚本提供了灵活的方式来获取和展示系统时区信息，支持多种输出格式以满足不同场景的需求。通过简单的命令调用，用户可以轻松获取所需的时区列表，并在需要时进行格式转换和处理。

## v-add-sys-firewall

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-add-sys-firewall)

### 脚本概述

`v-add-sys-firewall` 是一个 Hestia CLI 命令脚本，用于在系统上启用防火墙。该脚本通过执行一系列操作，包括添加默认规则集、更新防火墙配置以及记录日志等，来确保防火墙的正确启用。

### 使用方法

#### 基本语法

```bash
v-add-sys-firewall
```

运行该脚本将启动系统防火墙的启用过程。

### 工作原理

脚本执行时，会按照以下步骤进行：

1. **加载配置和函数**
   - 加载 Hestia 的配置文件 `hestia.conf`。
   - 加载 Hestia 的公共函数 `main.sh`。
   - 加载 Hestia 的配置文件 `hestia.conf`。

2. **验证**
   - 检查 `FIREWALL_SYSTEM` 是否设置为 `iptables`。如果已设置为 `iptables`，则直接退出脚本，因为 `iptables` 防火墙已经启用。
   - 检查是否启用了只读模式。如果启用了只读模式，则执行相应的检查和处理。

3. **执行操作**
   - 如果防火墙数据目录为空，则复制默认的防火墙规则集到该目录。
   - 更新 `FIREWALL_SYSTEM` 的配置值为 `iptables`。
   - 调用 `v-update-firewall` 脚本，以应用更新后的防火墙规则。

4. **日志记录**
   - 记录一条日志，表示系统防火墙已成功启用。

### 示例

#### 示例一：启用系统防火墙

假设当前系统没有启用任何防火墙，你可以通过运行以下命令来启用 Hestia 的系统防火墙：

```bash
$ v-add-sys-firewall
```

脚本将执行必要的步骤来启用防火墙，并在完成后记录一条日志。

### 注意事项

- 在运行脚本之前，请确保你已经备份了重要的系统配置和数据，以防意外情况发生。
- 如果系统已经启用了其他防火墙软件（如 `ufw`、`firewalld` 等），在运行此脚本之前，建议先禁用或卸载它们，以避免防火墙规则之间的冲突。
- 脚本中的某些操作可能需要管理员权限才能执行。因此，请以具有足够权限的用户身份运行脚本。

### 总结

`v-add-sys-firewall` 脚本提供了一个简单而有效的方式来启用 Hestia 的系统防火墙。通过执行一系列验证和操作，脚本确保了防火墙的正确启用，并提供了日志记录功能，以便管理员能够追踪和监控防火墙的状态。这对于保护系统安全至关重要，可以帮助防止未经授权的访问和潜在的网络攻击。

## v-add-sys-quota

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-add-sys-quota)

### 脚本概述

`v-add-sys-quota` 是 Hestia 的一个 CLI 命令脚本，用于在系统上启用 `/home` 分区的文件系统配额功能。此脚本会检查所需的内核模块和配额支持软件包是否已安装，并根据需要自动安装它们。此外，脚本还会配置 `/etc/fstab` 以支持配额，并设置必要的配额检查和启用配额的定时任务。

### 使用方法

#### 基本语法

```bash
v-add-sys-quota
```

运行该脚本将启动 `/home` 分区文件系统配额的启用过程。

### 工作原理

脚本执行时，会按照以下步骤进行：

1. **检查并安装内核模块**
   - 脚本首先会检查当前系统内核是否支持文件系统配额所需的内核模块。
   - 如果缺少必要的模块，脚本会安装这些模块，这可能涉及重启系统。

2. **安装配额支持软件包**
   - 脚本会检查是否安装了支持文件系统配额的软件包（如 `quota` 工具包）。
   - 根据操作系统类型（如基于 Debian 或 Red Hat 的系统），脚本会使用相应的包管理器来安装必要的软件包。

3. **配置 `/etc/fstab`**
   - 脚本获取 `/home` 分区的挂载点，并找到对应的 `/etc/fstab` 行。
   - 脚本会检查该行是否包含启用配额所需的选项（如 `usrquota`, `grpquota` 等）。
   - 如果这些选项不存在，脚本会更新 `/etc/fstab` 文件，并重新加载守护进程以应用更改。

4. **创建配额文件**
   - 脚本会检查 `/home` 分区下是否存在配额用户和用户组文件（如 `aquota.user` 和 `aquota.group`）。
   - 如果这些文件不存在，脚本会运行 `quotacheck` 命令来创建它们。

5. **设置配额检查定时任务**
   - 脚本会在 `/etc/cron.daily/` 目录下创建一个新的定时任务脚本，用于每天检查配额的使用情况。

6. **启用配额**
   - 脚本会检查 `/home` 分区的配额是否已启用。
   - 如果配额未启用，脚本会使用 `quotaon` 命令来启用它。

7. **更新系统配置和用户配额**
   - 脚本会更新系统配置，以反映已启用 `/home` 分区上的文件系统配额。
   - 脚本可能还会更新或设置现有用户的配额限制。

8. **记录日志**
   - 脚本会记录一条日志，表明 `/home` 分区上的文件系统配额已成功启用。

### 示例

#### 示例一：启用 `/home` 分区上的文件系统配额

假设你希望为你的 Hestia 系统启用 `/home` 分区上的文件系统配额，你可以运行以下命令：

```bash
$ v-add-sys-quota
```

脚本将执行上述步骤，并在完成后启用 `/home` 分区上的文件系统配额功能。

### 注意事项

- 在运行脚本之前，请确保备份了重要的系统配置和数据，以防万一。
- 脚本可能需要管理员权限来执行某些操作，如安装软件包和修改系统配置文件。
- 如果系统已经启用了 `/home` 分区的文件系统配额，但配置不正确或需要更新，该脚本也可以用于重新配置配额。
- 某些内核可能需要额外的软件包才能支持文件系统配额。在这种情况下，脚本会自动尝试安装这些软件包。

### 总结

`v-add-sys-quota` 脚本提供了一种简单、自动化的方式来启用和配置 `/home` 分区上的文件系统配额功能。通过检查和安装必要的内核模块和软件包，更新 `/etc/fstab` 配置，以及设置配额检查和自动启用配额的定时任务，该脚本确保了文件系统配额的正确启用和管理。这对于控制用户磁盘使用情况、防止磁盘空间耗尽以及维护系统稳定性非常有用。

## v-change-sys-hostname

* [命令行Bash 脚本查看](https://dns.hestiamb.org/doc/v-change-sys-hostname)

### 脚本概述

`v-change-sys-hostname` 是 Hestia 的一个 CLI 命令脚本，用于更改系统的主机名。该脚本会接受一个参数，即新的主机名，并执行一系列操作来更新系统配置，包括更新 `/etc/hosts` 文件、设置新的主机名，并更新相关的 Webmail 客户端配置。

### 使用方法

### 基本语法

```bash
v-change-sys-hostname <new_hostname>
```

其中 `<new_hostname>` 是你希望设置的新主机名。

### 示例

#### 示例一：将主机名更改为 `newserver`

```bash
$ v-change-sys-hostname newserver
```

运行此命令后，脚本将检查当前主机名，如果与 `newserver` 不同，则执行更改主机名的操作，并更新相关配置。

#### 示例二：处理具有特殊字符的主机名

```bash
$ v-change-sys-hostname "new-server.local"
```

如果新的主机名包含特殊字符（如连字符或点），确保在命令行中将其用引号括起来，以避免解析错误。

#### 示例三：处理已存在的主机名

```bash
$ v-change-sys-hostname currentserver
```

如果尝试将主机名更改为当前的主机名，脚本将检测到此情况并输出一条消息，表明不会执行任何更改。

### 工作原理

### 步骤概述

1. **检查参数** - 脚本首先检查是否提供了正确数量的参数（即一个新的主机名）。

2. **验证格式** - 验证提供的新主机名格式是否有效。

3. **检查演示模式** - 如果 Hestia 在演示模式下运行，脚本将检查并阻止更改主机名的操作。

4. **比较当前主机名** - 脚本会获取当前的主机名，并将其与新提供的主机名进行比较。如果两者相同，则不会进行任何更改。

5. **更改主机名** - 使用 `hostname` 命令更改系统主机名。

6. **更新配置文件** - 根据操作系统类型（如基于 RHEL/CentOS 或其他），脚本会更新相应的配置文件（如 `/etc/sysconfig/network` 或使用 `hostnamectl` 命令）。

7. **更新 Webmail 配置** - 如果检测到安装了 Roundcube、Rainloop 或 Snappymail Webmail 客户端，脚本会更新这些客户端的配置文件，以反映新的主机名。

8. **更新 /etc/hosts** - 脚本会更新 `/etc/hosts` 文件，将 `127.0.0.1` 对应的条目从当前主机名更改为新主机名，并确保没有重复的主机名条目。

### 注意事项

- 在运行此脚本之前，请确保备份了所有重要的配置文件，以防万一出现意外情况。
- 根据操作系统的不同，脚本可能需要管理员权限来执行所有操作。
- 更改主机名可能会影响系统上的某些服务，特别是那些依赖于主机名解析的服务。在更改主机名之前，最好通知所有相关的服务管理员。

### 总结

`v-change-sys-hostname` 脚本提供了一种简单、自动化的方式来更改 Hestia 系统的主机名，并更新相关的配置文件和 Webmail 客户端设置。通过此脚本，管理员可以轻松地将系统主机名更改为所需的任何有效名称，同时确保系统的稳定性和一致性。

## v-delete-sys-web-terminal

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-delete-sys-web-terminal)

### 脚本概述

`v-delete-sys-web-terminal` 是 Hestia 的一个 CLI 命令脚本，用于禁用 Web 终端功能。该脚本会更新系统配置，停止 Web 终端的 WebSocket 服务器，并禁用相应的 systemd 服务。

### 使用方法

### 基本语法

```bash
v-delete-sys-web-terminal
```

该脚本不需要任何参数。运行此命令后，脚本将执行禁用 Web 终端所需的所有操作。

### 示例

#### 示例一：禁用 Web 终端

```bash
$ v-delete-sys-web-terminal
```

运行此命令后，脚本将检查是否启用了 Web 终端功能，并执行禁用操作，包括更新配置、停止服务以及禁用 systemd 服务。

#### 示例二：处理未启用 Web 终端的情况

如果 Web 终端功能未启用，脚本将直接退出，不执行任何操作。

```bash
$ v-delete-sys-web-terminal
# 假设 WEB_TERMINAL 未启用，脚本将不会执行任何操作并退出。
```

#### 示例三：在只读模式下运行

如果 Hestia 在只读模式下运行，脚本将检查此模式并阻止执行禁用 Web 终端的操作。

```bash
$ v-delete-sys-web-terminal
# 假设 Hestia 在只读模式下运行，脚本将不会执行禁用操作并退出。
```

### 工作原理

### 步骤概述

1. **加载配置** - 脚本首先加载 Hestia 的配置文件，包括全局变量和函数定义。

2. **验证 Web 终端状态** - 脚本检查 `WEB_TERMINAL` 变量是否存在，以确认是否启用了 Web 终端功能。如果未启用，则脚本退出。

3. **检查只读模式** - 脚本执行检查以确定是否启用了 Hestia 的只读模式。如果是，则脚本退出，以避免进行任何修改。

4. **更新配置值** - 使用 `v-change-sys-config-value` 命令将 `WEB_TERMINAL` 的值设置为 `false`，以禁用 Web 终端功能。

5. **停止 WebSocket 服务器** - 脚本使用 `v-stop-service` 命令停止 `hestia-web-terminal` WebSocket 服务器，并确保它不再运行。

6. **禁用 systemd 服务** - 使用 `systemctl disable` 命令禁用 `hestia-web-terminal` 的 systemd 服务，以防止它在系统启动时自动启动。

7. **记录日志** - 脚本记录一条日志消息，指示 Web 终端已被禁用，并将此事件记录到 Hestia 的日志系统中。

8. **退出** - 完成所有操作后，脚本退出。

### 注意事项

- 在运行此脚本之前，请确保已经备份了重要的系统配置文件和日志，以防万一出现意外情况。
- 禁用 Web 终端可能会影响用户对服务器的远程访问能力，特别是那些依赖于 Web 终端进行管理的用户。因此，在执行此操作之前，请确保通知所有相关用户，并确保他们有其他方式可以访问服务器。
- 如果系统中有其他服务或脚本依赖于 Web 终端功能，禁用它可能会导致这些服务或脚本无法正常工作。在禁用 Web 终端之前，请确保评估这种影响并采取相应的预防措施。

## v-delete-sys-quota

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-delete-sys-quota)

### 脚本概述

`v-delete-sys-quota` 是 Hestia 的一个 CLI 命令脚本，用于删除系统配额，即禁用 `/home` 分区上的文件系统配额。该脚本会更新 Hestia 配置，从 `/etc/fstab` 文件中移除配额相关的选项，重新挂载文件系统，并删除相关的配额索引文件和 cron 任务。

### 使用方法

### 基本语法

```bash
v-delete-sys-quota
```

该脚本不需要任何参数，直接运行即可执行删除系统配额的操作。

### 示例

#### 示例一：删除系统配额

```bash
$ v-delete-sys-quota
```

运行此命令后，脚本将执行以下操作：

1. 检查 Hestia 是否处于只读模式，如果是则阻止执行操作。
2. 查找 `/home` 分区在 `/etc/fstab` 文件中的配置行，并移除与用户和组配额相关的选项。
3. 重新加载 systemd 守护进程配置，并重新挂载 `/home` 分区以应用更改。
4. 禁用 `/home` 分区上的用户和组配额。
5. 删除 `/home` 分区下的配额索引文件。
6. 删除与配额检查相关的 cron 任务。
7. 更新 Hestia 配置文件中的 `DISK_QUOTA` 值，设置为 `no`。
8. 记录一条日志消息，指示系统配额强制执行已禁用。

#### 示例二：处理没有启用配额的情况

如果 `/home` 分区上没有启用配额功能，脚本将不会执行任何与配额相关的操作，但仍会更新 Hestia 配置文件和记录日志。

```bash
$ v-delete-sys-quota
# 假设 /home 分区上没有启用配额，脚本将只更新配置和记录日志。
```

### 工作原理

### 步骤概述

1. **加载配置** - 脚本首先加载 Hestia 的配置文件，包括全局变量和函数定义。

2. **只读模式检查** - 检查 Hestia 是否处于只读模式，如果是，则退出脚本以防止任何修改。

3. **修改 fstab** - 查找 `/home` 分区在 `/etc/fstab` 文件中的配置行，并移除与用户和组配额相关的选项。

4. **重新挂载** - 重新加载 systemd 守护进程配置，并重新挂载 `/home` 分区，以确保配额选项的更改生效。

5. **禁用配额** - 使用 `quotaoff` 命令禁用 `/home` 分区上的用户和组配额。

6. **删除配额索引** - 删除 `/home` 分区下的配额索引文件，这些文件记录了配额的使用情况。

7. **删除 cron 任务** - 删除与配额检查相关的 cron 任务，以避免未来的配额检查。

8. **更新配置值** - 使用 `v-change-sys-config-value` 命令更新 Hestia 配置文件中的 `DISK_QUOTA` 值，以反映配额已被禁用。

9. **记录日志** - 记录一条日志消息，表明系统配额强制执行已被禁用。

10. **退出** - 完成所有操作后，脚本退出。

### 注意事项

- 在运行此脚本之前，请确保已备份了重要的系统配置文件，以防万一出现意外情况。
- 禁用配额可能会影响用户对磁盘空间的使用限制。因此，在执行此操作之前，请确保已通知所有相关用户，并确保他们了解配额已被禁用。
- 如果系统中有其他服务或脚本依赖于配额功能，禁用配额可能会导致这些服务或脚本的行为发生变化。在禁用配额之前，请确保评估这种影响并采取相应的预防措施。

## v-delete-sys-sftp-jail

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-delete-sys-sftp-jail)

### 脚本概述

`v-delete-sys-sftp-jail` 脚本用于禁用系统 SFTP 的 jail 环境，即移除通过 chroot 系统调用或类似机制将用户进程限制在特定文件系统目录的限制。执行此脚本后，SFTP 用户将能够访问整个文件系统，而不仅仅是 jail 环境指定的目录。

### 使用方法

#### 基本语法

```bash
v-delete-sys-sftp-jail
```

该脚本无需任何参数，直接运行即可执行禁用 SFTP jail 环境的操作。

#### 示例

#### 示例一：禁用 SFTP jail 环境

```bash
$ v-delete-sys-sftp-jail
```

运行此命令后，脚本将执行以下操作：

1. 检查系统状态，确保可以安全地修改 SFTP 配置。
2. 查找 SSH 服务器配置文件（例如 `/etc/ssh/sshd_config`）中与 SFTP jail 环境相关的配置行。
3. 注释或删除这些配置行，以禁用 chroot 或类似的限制机制。
4. 验证修改后的 SSH 配置文件是否正确无误。
5. 尝试重启 SSH 服务，使配置更改生效。
6. 如果重启失败，记录错误日志并发送通知（如果配置了通知功能）。
7. 记录一条日志消息，指示 SFTP jail 环境已被禁用。

#### 示例二：处理未启用 jail 环境的情况

如果系统上原本就没有启用 SFTP jail 环境，脚本将不会进行任何修改，并可能记录一条消息说明这一点。

```bash
$ v-delete-sys-sftp-jail
# 如果SFTP jail环境原本未启用，脚本将不执行任何操作，并记录相应信息。
```

### 注意事项

- **安全性**：禁用 SFTP jail 环境会提高用户访问系统文件的权限，可能增加安全风险。在执行此操作前，请确保您了解潜在的安全影响，并采取适当的安全措施。
- **备份**：在修改任何系统配置文件之前，强烈建议备份原始文件。这有助于在出现问题时恢复到之前的状态。
- **依赖服务**：如果系统中有其他服务或脚本依赖于 SFTP jail 环境，禁用该功能可能会对这些服务或脚本产生影响。在禁用之前，请确保评估这种影响。
- **测试**：在实际环境中应用此脚本之前，建议在测试环境中进行充分测试，以确保脚本按预期工作且不会对系统造成不良影响。

## v-delete-sys-ip

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-delete-sys-ip)

`v-delete-sys-ip` 命令脚本是用于删除系统中特定 IP 地址的脚本。该函数用于删除系统 IP，但不允许删除在接口上的第一个 IP，也不允许删除 Web 域使用的 IP。这确保了系统的网络配置和 Web 服务的稳定性。以下是该脚本的详细功能说明：

### 功能说明

### 1. 检查 IP 地址的可用性

在删除 IP 地址之前，脚本会首先检查要删除的 IP 地址是否可用。特别是，脚本会验证该 IP 地址是否是在接口上的第一个 IP，以及是否被 Web 域所使用。如果是第一个 IP 地址或被 Web 域使用，脚本将不会执行删除操作，以确保系统的网络连通性和 Web 服务的正常运行。

### 2. 删除 IP 地址并更新转发规则配置

如果 IP 地址可用，脚本会继续执行删除操作。它会检查是否存在相关的配置文件，并根据配置文件中是否包含指定的 IP 地址，进行相应的更新操作。这包括从 `mod_extract_forwarded.conf`、`rpaf.conf` 和 `remoteip.conf` 文件中移除 IP 地址相关的配置行。

### 3. 更新用户 IP 配额

脚本会根据 IP 地址的所有者（由 `$OWNER` 变量指定）来更新用户的 IP 配额信息。如果所有者是系统管理员或根用户（由 `$ROOT_USER` 变量指定），脚本会根据不同的状态来更新不同用户的配额。如果所有者不是系统管理员，则仅更新该用户的配额。

### 4. 重启服务和更新防火墙

完成上述配置和配额更新后，脚本会尝试重启 Web 服务以确保更改生效，并检查重启操作是否成功。如果系统中配置了代理服务，脚本还会重启代理服务。此外，如果定义了防火墙系统，脚本会更新防火墙配置以反映 IP 地址的删除。

### 5. 记录日志

脚本会在执行过程中记录相关的日志信息，包括 IP 地址的删除操作、服务的重启情况以及任何可能的错误或异常。这些日志信息有助于追踪和诊断潜在的问题。

### 使用方法

要使用 `v-delete-sys-ip` 命令脚本，您需要在命令行中执行该脚本，并传递必要的参数，如要删除的 IP 地址等。具体的参数和用法可以通过查看脚本的帮助文档或相关文档来获取。

### 注意事项

* 在执行脚本之前，请确保已经备份了重要的配置文件和数据库，以防止数据丢失或损坏。
* 脚本的执行可能需要一些时间，具体取决于系统的配置和性能。在执行过程中，请耐心等待，并避免中断脚本的执行。
* 如果在执行脚本过程中遇到任何问题或错误，请查阅相关的日志文件或联系系统管理员以获取帮助。

### 总结

`v-delete-sys-ip` 命令脚本是一个用于删除系统中特定 IP 地址的实用工具。通过检查 IP 地址的可用性、更新配置、配额和重启服务，它确保了 IP 地址的删除操作能够正确且有效地执行，同时维护了系统的稳定性和安全性。

## v-change-sys-service-config

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-change-sys-service-config)

`v-change-sys-service-config` 是 Hestia 控制面板的命令行工具，用于更改系统服务的配置文件。通过此脚本，管理员能够方便地更新指定服务的配置文件，并在需要时重启服务以应用更改。

### 基本用法

```bash
v-change-sys-service-config [源文件路径] [服务名称] [是否重启服务]
```

- **源文件路径**：包含新配置内容的文件路径。
- **服务名称**：要更新配置的服务名称。
- **是否重启服务**：一个可选参数，表示是否在配置更新后重启服务。通常使用 'yes' 或 'no'。

### 支持的服务

此脚本支持多种服务，包括 Nginx、Apache、Exim、Dovecot、MySQL、MariaDB、PostgreSQL、SpamAssassin、Fail2ban 等。对于特定服务，脚本会定位到正确的配置文件路径。

### 示例

### 示例 1：修改 Nginx 配置文件并重启服务

```bash
v-change-sys-service-config /path/to/new/nginx.conf nginx yes
```

### 示例 2：更新 PHP 配置而不重启服务

```bash
v-change-sys-service-config /path/to/new/php.ini php no
```

### 示例 3：尝试修改不存在的服务配置

```bash
v-change-sys-service-config /path/to/config some-nonexistent-service yes
```

输出可能类似于：

```BASH
Error: service some-nonexistent-service doesn't exist
```

### 工作流程

1. **检查参数**：脚本首先检查是否提供了必要的参数，并验证服务名称的有效性。

2. **定位配置文件**：根据服务名称，脚本定位到对应的配置文件路径。

3. **比较配置**：使用 `diff` 命令比较源文件与现有配置文件的差异。

4. **更新配置**：如果源文件与现有配置不同，脚本将备份现有配置，并将源文件复制到配置文件位置。

5. **重启服务**（可选）：如果指定了重启服务，并且配置更新成功，脚本将尝试重启对应的服务。

6. **错误处理**：如果在重启服务时发生错误，脚本将回滚配置更改，并输出错误信息。

7. **记录日志**：无论操作是否成功，脚本都会记录相关事件到日志中。

### 注意事项

- 在运行脚本之前，请确保你具有足够的权限来修改目标配置文件和重启服务。
- 配置文件路径必须是有效的，并且指向正确的文件。
- 重启服务可能会对正在运行的服务造成影响，因此在生产环境中请谨慎操作。
- 在使用脚本之前，建议备份原始的配置文件，以防止意外发生。

### 总结

`v-change-sys-service-config` 脚本为 Hestia 控制面板用户提供了一个方便的工具，用于管理各种服务的配置文件。通过正确地使用此脚本，管理员可以高效地更新服务配置，并确保系统的稳定运行。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-change-sys-timezone

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-change-sys-timezone)

`v-change-sys-timezone` 是 Hestia 控制面板的一个命令行工具，用于更改系统时区设置。该脚本会自动检查参数的有效性，更新系统时区，并在必要时修改 PHP 的时区配置。

### 基本用法

```bash
v-change-sys-timezone [时区]
```

- **时区**：要设置的系统时区，例如 `Asia/Shanghai`。

### 示例

#### 示例 1：设置系统时区为纽约

```bash
v-change-sys-timezone America/New_York
```

#### 示例 2：设置系统时区为东京

```bash
v-change-sys-timezone Asia/Tokyo
```

### 脚本执行流程

1. **参数检查**：脚本首先检查是否提供了必需的参数（时区）。

2. **时区验证**：通过检查 `/usr/share/zoneinfo/` 目录下是否存在对应的时区文件来验证时区是否有效。

3. **只读模式检查**：如果系统处于只读模式（例如，演示模式），则脚本会阻止时区更改。

4. **设置系统时区**：
   - 如果系统支持 `timedatectl` 命令（如较新版本的 Linux 发行版），则使用 `timedatectl set-timezone` 来设置时区。
   - 如果不支持 `timedatectl`，则更新 `/etc/sysconfig/clock`（如果存在）、`/etc/timezone` 文件，并重新链接 `/etc/localtime` 到正确的时区文件。

5. **修改 PHP 时区**：如果检测到 `WEB_SYSTEM` 变量（例如，系统安装了 Web 服务器），脚本会遍历所有 PHP 配置文件（`php.ini`），并更新其中的 `date.timezone` 设置。

6. **日志记录**：记录一条系统日志，表示时区已成功更改，并包含新时区值。

7. **退出**：脚本执行完毕后退出。

### 注意事项

- 在运行此脚本之前，请确保您具有足够的权限来更改系统时区配置和 PHP 配置文件。
- 请确保输入的时区名称是正确且存在的，以避免脚本执行错误。
- 更改系统时区可能会影响正在运行的服务和应用程序，因此在生产环境中进行此操作前，请确保了解潜在影响并谨慎操作。

### 总结

`v-change-sys-timezone` 脚本提供了一个方便的方式来更改 Hestia 控制面板管理的系统的时区设置。通过正确地使用此脚本，管理员可以轻松地调整系统时区，并确保应用程序和服务使用正确的日期和时间。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-change-sys-language

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-change-sys-language)

`v-change-sys-language` 是 Hestia 控制面板的一个命令行工具，用于更改系统语言设置。该脚本会验证输入的语言代码的有效性，并更新系统配置文件以应用新的语言设置。此外，如果指定了更新用户语言的选项，脚本还会为所有现有用户更新语言设置。

### 基本用法

```bash
v-change-sys-language [语言代码] [是否更新用户语言]
```

- **语言代码**：要设置的系统语言代码，例如 `en`（英语）、`ru`（俄语）等。
- **是否更新用户语言**：可选参数，如果设置为 `yes`，则会为所有现有用户更新语言设置。默认为不更新。

### 示例

#### 示例 1：设置系统语言为俄语

```bash
v-change-sys-language ru
```

#### 示例 2：设置系统语言为法语，并更新所有用户语言

```bash
v-change-sys-language fr yes
```

### 脚本执行流程

1. **参数检查**：脚本首先检查是否提供了必需的语言代码参数，并验证其格式是否正确。

2. **语言验证**：通过检查语言代码是否仅包含字母数字字符和下划线，并确认相应的语言目录是否存在来验证语言的有效性。

3. **只读模式检查**：如果系统处于只读模式（例如，演示模式），则脚本会阻止语言更改。

4. **更改系统语言**：更新 Hestia 配置文件（`hestia.conf`）中的 `LANGUAGE` 设置，以应用新的语言代码。

5. **更新用户语言**（如果指定）：如果提供了 `yes` 作为第二个参数，脚本会遍历所有现有用户，并使用 `v-change-user-language` 命令为每个用户更新语言设置。

6. **日志记录**：记录一条系统日志，表示语言已成功更改，并包含新的语言代码。

7. **退出**：脚本执行完毕后退出。

### 注意事项

- 在运行此脚本之前，请确保您具有足够的权限来更改系统配置和用户设置。
- 请确保输入的语言代码是正确且存在的，以避免脚本执行错误。
- 更改系统语言可能会影响用户界面和消息的显示，因此在生产环境中进行此操作前，请确保了解潜在影响并谨慎操作。

### 总结

`v-change-sys-language` 脚本提供了一个方便的方式来更改 Hestia 控制面板管理的系统的语言设置。通过正确地使用此脚本，管理员可以轻松地调整系统语言，并确保应用程序和服务使用正确的语言进行显示。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-change-sys-config-value

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-change-sys-config-value)

`v-change-sys-config-value` 是 Hestia 控制面板的一个命令行工具，用于更改主配置文件中的系统设置值。这个脚本可以更改如 `COMPANY_NAME` 或 `COMPANY_EMAIL` 等关键设置。

### 基本用法

```bash
v-change-sys-config-value KEY VALUE
```

- **KEY**：要更改的配置项键名。
- **VALUE**：要设置的新值。

### 示例

#### 示例 1：更改公司名称为 "MyCompany"

```bash
v-change-sys-config-value COMPANY_NAME "MyCompany"
```

#### 示例 2：设置版本号为 "1.2.3"

```bash
v-change-sys-config-value VERSION "1.2.3"
```

### 脚本执行流程

1. **参数处理**：脚本将接收到的键名转换为大写，并保存值。

2. **加载配置文件与函数**：脚本加载 Hestia 配置文件以及必要的函数。

3. **只读模式检查**：如果系统处于只读模式（如演示模式），脚本将阻止配置更改。

4. **参数验证**：脚本检查是否提供了正确数量的参数（键和值），并验证它们的格式。

5. **更改配置值**：使用 `change_sys_value` 函数更新配置文件中的对应项。

6. **排序配置文件**：对配置文件进行字母顺序排序，以确保配置项的顺序一致。

7. **备份与替换**：将原始配置文件备份，并用排序后的配置文件替换。

8. **记录日志**：记录一条系统日志，说明配置值已成功更改，并包含更改的键和值。

9. **退出**：脚本执行完毕后退出。

### 注意事项

- 在运行此脚本之前，请确保您具有足够的权限来更改系统配置。
- 请确保键名是正确的，并且值是适用于该键的合法值。
- 在生产环境中进行配置更改之前，建议先进行备份，以防万一。
- 更改某些配置项可能会影响系统的行为或外观，因此请确保了解每项配置的作用和潜在影响。

### 总结

`v-change-sys-config-value` 脚本提供了一种灵活的方式来更改 Hestia 控制面板管理的系统的配置设置。通过正确地使用此脚本，管理员可以轻松地调整各种配置选项，以满足特定的需求或修复配置问题。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-restart-system

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-restart-system)

`v-restart-system` 是 Hestia 控制面板的一个命令行工具，用于重启操作系统。该脚本通过检查输入参数和执行一系列验证，安全地触发系统重启。

### 基本用法

```bash
v-restart-system RESTART [DELAY]
```

- **RESTART**：一个字符串，用于指示是否要重启系统。通常设置为 'yes' 以触发重启。
- **DELAY**（可选）：一个整数，表示在重启之前等待的秒数。

### 示例

#### 示例 1：立即重启系统

```bash
v-restart-system yes
```

#### 示例 2：在 5 分钟后重启系统

```bash
v-restart-system yes 300
```

### 脚本执行流程

1. **参数定义**：脚本获取输入的 `restart` 和 `delay` 参数。

2. **加载配置与函数**：脚本加载 Hestia 配置文件和必要的函数。

3. **参数验证**：脚本检查是否至少提供了一个参数（即 `restart`），并确认是否处于只读模式（如演示模式）。

4. **执行重启**：如果 `restart` 参数为 'yes'，则记录一条系统日志，表明系统重启已启动。

5. **延迟执行**：如果提供了 `delay` 参数，脚本将输出一条消息，告知用户服务器将在多少秒后重启，并等待指定的延迟时间。

6. **执行重启命令**：最后，脚本执行 `/sbin/reboot` 命令以触发系统重启。

7. **退出**：脚本执行完毕后退出。

### 注意事项

- 在运行此脚本之前，请确保您具有足够的权限来重启系统。
- 重启系统将会中断所有正在运行的服务和进程，因此在执行此操作前请确保保存所有重要的数据和配置。
- 如果提供了 `delay` 参数，请确保延迟时间足够长，以便您可以安全地关闭所有打开的连接和应用程序。
- 在生产环境中执行系统重启之前，建议先通知所有相关用户，并确保已经备份了所有重要数据。

### 总结

`v-restart-system` 脚本提供了一种简单而安全的方式来重启 Hestia 控制面板管理的系统。通过正确地使用此脚本，管理员可以轻松地计划系统重启，以满足维护需求或解决潜在问题。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-update-sys-queue

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-update-sys-queue)

`v-update-sys-queue` 是 Hestia 控制面板的一个命令行工具，用于更新系统队列。此脚本负责处理队列中的任务，包括服务重启、计划备份、Web 日志解析等需要消耗大量系统资源的操作。通过优化系统行为，它可以确保服务如 Apache 仅在必要时被重启，即使添加了或删除了多个域名。

### 基本用法

```bash
v-update-sys-queue QUEUE
```

- **QUEUE**：指定要处理的队列类型。

### 示例

#### 示例 1：重启服务队列

```bash
v-update-sys-queue restart
```

#### 示例 2：更新 Web 统计信息队列

```bash
v-update-sys-queue webstats
```

#### 示例 3：执行备份队列

```bash
v-update-sys-queue backup
```

### 脚本执行流程

1. **参数定义**：脚本接收一个参数 `queue`，代表要处理的队列类型。

2. **加载配置与函数**：脚本加载 Hestia 的配置文件和必要的函数。

3. **参数验证**：检查是否提供了一个参数，并确认其有效性。

4. **检查队列任务**：脚本会检查当前正在运行的任务数量，如果备份或 DNS 队列的任务数超过两个，则脚本会立即退出。

5. **执行队列任务**：根据提供的队列类型，脚本会调用对应的 `.pipe` 文件来执行相应的任务。这些任务通常包含一系列系统命令和脚本，用于完成特定的系统维护或更新操作。

6. **输出处理**：所有队列任务的输出都被重定向到 `/dev/null`，以避免在终端显示任何输出信息。

7. **退出**：脚本执行完毕后退出。

### 注意事项

- 在运行此脚本之前，请确保您具有足够的权限来执行队列中的任务。
- 根据队列任务的性质，执行此脚本可能需要消耗一定的系统资源，因此在执行过程中请确保系统具有足够的资源可用。
- 由于该脚本负责处理系统队列，因此它可能会影响到系统的正常运行和性能。在生产环境中执行此脚本时，请确保了解脚本的功能和潜在影响，并根据需要进行适当的测试和监控。

### 总结

`v-update-sys-queue` 脚本是 Hestia 控制面板中一个重要的系统管理工具，用于处理系统队列中的任务。通过正确地使用此脚本，管理员可以轻松地更新系统队列，执行各种维护任务，并优化系统的行为。在使用此脚本时，请遵循最佳实践，并根据需要查阅相关文档或寻求帮助。

## v-start-service

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-start-service)

### 功能描述

`v-start-service` 是Hestia控制面板中的一个CLI（命令行界面）脚本，用于启动系统服务。通过指定服务名称作为参数，脚本会尝试启动该服务，并记录相关日志。

### 使用方法

要启动一个服务，您需要运行以下命令，并将`SERVICE`替换为要启动的实际服务名称：

```bash
v-start-service SERVICE
```

例如，要启动MySQL服务，您可以运行：

```bash
v-start-service mysql
```

### 脚本执行流程

1. **参数定义**：脚本首先定义了一个变量`service`，用于存储传入的服务名称参数。

2. **加载配置与函数库**：脚本加载Hestia的配置文件、函数库和网络配置信息。

3. **参数检查**：脚本调用`check_args`函数检查是否已传入正确的参数数量，并调用`is_format_valid`函数验证服务名称的格式。

4. **处理PHP-FPM服务**：如果服务名称为`php-fpm`，则脚本会遍历所有已安装的PHP版本，并为每个版本生成相应的`php${php_ver}-fpm`服务名称。

5. **启动服务**：对于每个服务名称，脚本使用`systemctl`命令尝试启动该服务。如果服务名称是`iptables`，则调用`v-update-firewall`来更新防火墙配置。

6. **记录日志**：根据服务启动的结果，脚本调用`v-log-action`函数记录相应的日志信息。如果服务启动成功，则记录信息日志；如果启动失败，则记录错误日志。

7. **检查结果**：脚本检查服务启动的返回结果，如果返回非零值，则记录错误并调用`check_result`函数输出错误信息。

8. **日志记录**：最后，脚本使用`log_event`函数记录操作事件，并退出脚本。

### 注意事项

- **权限要求**：运行该脚本通常需要相应的权限，确保当前用户具有启动系统服务的权限。

- **服务名称**：请确保传入的服务名称正确无误，并且该服务在系统中是可用的。

- **日志记录**：脚本会记录服务启动的日志信息，包括成功和失败的情况。确保查看日志文件以获取相关的操作记录。

- **错误处理**：如果服务启动失败，脚本会记录错误信息并尝试提供有用的提示。然而，具体的错误原因可能需要管理员进一步调查。

### 总结

`v-start-service` 脚本是Hestia控制面板中用于启动系统服务的重要工具。通过传入服务名称作为参数，管理员可以方便地启动所需的服务，并监控服务的启动状态。在使用该脚本时，请确保了解脚本的功能和注意事项，并根据实际需求进行操作。

## v-stop-firewall

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-stop-firewall)

### 功能描述

`v-stop-firewall` 是Hestia控制面板中的一个CLI（命令行界面）脚本，用于停止和重置防火墙规则。脚本通过修改iptables规则来实现防火墙的停止，并将规则恢复到初始状态。

### 使用方法

要停止防火墙并重置规则，您只需运行以下命令：

```bash
v-stop-firewall
```

该脚本不需要任何额外的参数。

### 脚本执行流程

1. **加载配置与函数库**：脚本首先加载Hestia的配置文件、主函数库和防火墙函数库。

2. **检查演示模式**：脚本调用`check_hestia_demo_mode`函数检查系统是否处于演示模式。如果是演示模式，可能不会有任何实际操作。

3. **修复iptables链接**：通过`heal_iptables_links`函数确保iptables命令的链接正确无误。

4. **生成临时脚本**：脚本创建一个临时文件，并向其中写入一系列iptables命令，用于设置INPUT链的策略为ACCEPT，清空INPUT链，以及删除名为hestia的自定义链。

5. **处理自定义链**：脚本读取`$HESTIA/data/firewall/chains.conf`文件（如果存在），并为每个列出的自定义链（fail2ban链）执行清空和删除操作。

6. **执行iptables命令**：脚本执行临时文件中记录的iptables命令，以应用上述更改。

7. **清理临时文件**：脚本删除临时文件以释放磁盘空间。

8. **保存防火墙规则**：根据系统配置，脚本将当前的iptables规则保存到`/etc/sysconfig/iptables`或`/etc/iptables.rules`文件中。同时，它会移除与fail2ban相关的特定规则。

9. **创建或更新systemd服务单元**：如果`/lib/systemd/system/hestia-iptables.service`文件不存在，脚本会创建它，并定义服务单元的内容。服务单元负责在系统启动时加载Hestia的防火墙规则。根据iptables的版本，脚本会设置不同的`ExecStart`命令。

10. **重新加载systemd守护进程**：如果创建了新的服务单元文件，脚本会调用`systemctl -q daemon-reload`命令，通知systemd守护进程重新加载其配置。

11. **检查并启用服务**：脚本使用`systemctl -q is-enabled`命令检查`hestia-iptables.service`服务是否已启用。如果未启用，脚本会尝试启用它，以确保在系统启动时自动加载防火墙规则。

### 注意事项

- **权限要求**：运行该脚本通常需要root权限，因为修改iptables规则需要管理员权限。

- **防火墙状态**：在执行此脚本后，防火墙将被重置为初始状态，所有自定义规则都将被清除。请确保在执行此操作之前备份重要的防火墙规则。

- **系统配置**：脚本会根据系统的不同配置（如iptables版本和是否存在特定文件或目录）执行不同的操作。因此，在不同系统上执行脚本可能会有所不同。

- **日志记录**：脚本可能不会直接记录操作日志，但iptables规则的变化通常会记录在系统的日志文件中，如`/var/log/messages`或`/var/log/syslog`。

### 总结

`v-stop-firewall` 脚本是Hestia控制面板中用于停止和重置防火墙规则的重要工具。通过执行一系列iptables命令和保存规则到文件，脚本能够安全地停止防火墙并准备系统以接受新的防火墙配置。在使用该脚本时，请确保了解脚本的功能和注意事项，并根据实际需求进行操作。

## v-stop-service

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-stop-service)

### 功能描述

`v-stop-service` 是一个用于停止系统服务的Hestia控制面板CLI（命令行界面）脚本。通过传递服务名称作为参数，脚本将尝试停止指定的服务。

### 使用方法

要停止一个服务，您需要使用以下命令格式：

```bash
v-stop-service SERVICE_NAME
```

其中 `SERVICE_NAME` 是您想要停止的服务的名称。

### 示例

#### 示例1：停止Apache2服务

```bash
v-stop-service apache2
```

这个命令将尝试停止名为`apache2`的服务。

#### 示例2：停止PHP-FPM服务

```bash
v-stop-service php-fpm
```

对于`php-fpm`服务，脚本会检测系统上安装的所有PHP版本，并尝试停止每个版本的PHP-FPM服务。

### 脚本执行流程

1. **参数定义**：脚本从命令行参数中获取要停止的服务的名称。

2. **加载配置与函数库**：脚本加载Hestia的配置文件、主函数库，并读取Hestia的配置。

3. **参数检查**：脚本检查是否提供了正确的参数数量，并验证服务名称的格式是否有效。

4. **检查只读模式**：如果系统处于只读模式（如演示模式），脚本将执行相应的检查。

5. **处理PHP-FPM服务**：如果服务名称为`php-fpm`，脚本将检测系统上安装的所有PHP版本，并为每个版本构建要停止的服务列表。

6. **停止服务**：脚本遍历服务列表，并使用`systemctl stop`命令尝试停止每个服务。对于`iptables`服务，脚本调用`v-stop-firewall`脚本来停止防火墙。

7. **记录日志**：根据服务的停止结果，脚本记录相应的日志信息，包括错误或成功信息。

8. **检查结果**：脚本检查每个服务停止操作的结果，并在遇到错误时记录错误消息。

9. **事件日志**：最后，脚本记录一个事件日志，表示服务停止操作的完成状态。

### 注意事项

- **权限要求**：运行此脚本通常需要root权限，因为停止系统服务通常需要管理员权限。

- **服务名称**：确保提供的服务名称正确，否则脚本可能无法找到或停止相应的服务。

- **服务依赖**：停止某些服务可能会影响系统的其他部分或依赖于这些服务的应用程序。在停止服务之前，请确保了解服务的依赖关系并评估潜在的影响。

- **系统配置**：脚本的行为可能受到系统配置的影响，例如systemd的配置或服务的定义方式。

- **错误处理**：脚本包含错误处理逻辑，以记录并处理服务停止失败的情况。但是，它可能无法处理所有可能的错误情况。

### 总结

`v-stop-service` 脚本是Hestia控制面板中用于停止系统服务的重要工具。通过传递服务名称作为参数，脚本能够安全地停止指定的服务，并记录相应的日志信息。在使用此脚本时，请确保了解服务的依赖关系和潜在影响，并根据实际需求进行操作。

## v-restart-proxy

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-restart-proxy)

### 功能描述

`v-restart-proxy` 是一个用于重启Hestia控制面板中的代理服务的CLI（命令行界面）脚本。该脚本通常用于确保代理配置的正确性，并在必要时执行重启操作。

### 使用方法

要重启代理服务，您可以使用以下命令格式：

```bash
v-restart-proxy [选项]
```

其中 `[选项]` 可以是以下值之一：

- `no`：不执行重启操作。
- `scheduled`：计划重启代理，通常用于排定重启任务。
- `background`：在后台执行重启操作。
- `updatessl`：更新SSL证书后重启代理。

### 脚本执行流程

1. **加载配置与函数库**：脚本首先加载Hestia的配置文件、主函数库，并读取相关的配置。

2. **变量定义**：脚本定义了一个时间戳变量`date`，用于记录日志的时间信息。

3. **定义send_email_report函数**：这个函数用于在代理重启失败时发送电子邮件报告。它首先获取联系人的电子邮件地址，然后创建一个临时文件来记录nginx的配置测试和服务重启的输出。如果指定了`DO_RESTART`参数，则会尝试重启代理服务。最后，将临时文件的内容通过电子邮件发送给联系人，并在调试模式下将日志记录到`/var/log/hestia/debug.log`文件中。

4. **检查PROXY_SYSTEM变量**：脚本检查`PROXY_SYSTEM`变量是否存在，以及是否设置为`'remote'`。如果是，则脚本直接退出，因为远程代理不需要本地重启。

5. **处理命令行参数**：根据传入的参数，脚本执行不同的操作。
   - 如果参数为`no`，则脚本直接退出，不执行任何操作。
   - 如果参数为`scheduled`或未指定参数但`SCHEDULED_RESTART`变量为`yes`，则脚本将重启任务添加到重启队列中，并退出。
   - 如果参数为`updatessl`，则脚本将SSL更新任务添加到重启队列中，并退出。
   - 如果参数为`background`，则脚本在后台执行重启操作，并先等待15秒以确保其他进程已经完成。然后，执行nginx的配置测试，如果测试失败，则调用`send_email_report`函数发送报告，并记录错误结果。最后，使用`v-restart-service`脚本重启代理服务，并从重启队列中删除相应的条目。

6. **处理自定义nginx代理配置**：如果检测到自定义的nginx代理配置文件存在，则脚本会执行特定的操作。对于`background`参数，脚本会在后台重启代理，并先执行nginx的配置测试。如果测试失败，则发送报告并记录错误。然后，使用`nohup`命令在后台执行重启操作，并将输出重定向到`/dev/null`。

7. **无自定义nginx代理配置**：如果没有检测到自定义的nginx代理配置文件，则脚本根据调试模式执行nginx的配置测试，并记录日志。但脚本不会执行实际的重启操作。

### 注意事项

- **权限要求**：运行此脚本通常需要root权限，因为重启系统服务通常需要管理员权限。

- **代理类型**：脚本会根据`PROXY_SYSTEM`变量的值来确定要重启的代理服务类型。确保该变量正确设置。

- **队列管理**：对于计划重启和SSL更新任务，脚本使用队列机制来管理重启任务。这有助于确保重启操作的有序执行。

- **调试模式**：如果启用了调试模式（`DEBUG_MODE`为`true`），脚本将记录更多的调试信息到`/var/log/hestia/debug.log`文件中，有助于排查问题。

- **错误处理**：脚本包含基本的错误处理逻辑，如发送电子邮件报告和记录错误日志。但是，它可能无法处理所有可能的错误情况。

### 总结

`v-restart-proxy` 脚本是Hestia控制面板中用于重启代理服务的重要工具。通过传入不同的参数，脚本能够灵活地处理不同的重启场景，并提供了队列管理和错误处理机制。在使用此脚本时，请确保了解代理服务的配置和依赖关系，并根据实际需求进行操作。

## v-restart-service

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-restart-service)

### 功能描述

`v-restart-service` 是一个用于重启Hestia控制面板中的指定系统服务的CLI（命令行界面）脚本。脚本可以处理各种服务类型，并包含特定于某些服务的重启逻辑。

### 使用方法

要重启系统服务，您可以使用以下命令格式：

```bash
v-restart-service SERVICE [RESTART]
```

其中：

- `SERVICE`：要重启的服务的名称。
- `RESTART`：可选参数，用于指定重启类型。如果未指定，脚本将尝试重新加载或重启服务（取决于服务的类型）。
### 可选参数 `RESTART`

- `ssl`：仅对`nginx`服务有效，用于触发SSL相关的重启或更新。
- `no` 或未指定：执行默认的重启操作，通常是通过`systemctl`命令来重启服务。
- 其他特定值：根据服务的不同，可能支持其他特定的重启类型或选项。

### 脚本执行流程

1. **参数检查**：脚本首先检查是否提供了正确的参数数量，并验证参数格式是否有效。

2. **加载配置与函数库**：脚本加载Hestia的配置文件、主函数库，并读取相关的配置。

3. **日志设置**：根据`DEBUG_MODE`的值确定日志的输出位置。如果调试模式开启，则日志记录到`/var/log/hestia/debug.log`文件中；否则，日志输出到`/dev/null`（即不记录）。

4. **处理PHP-FPM服务**：如果指定的服务是`php-fpm`，脚本会获取系统上安装的所有PHP版本，并为每个版本构建要重启的PHP-FPM服务列表。

5. **服务重启**：对于每个要重启的服务，脚本执行以下操作：
   - 如果服务是`iptables`防火墙，则执行停止和更新防火墙规则的特定逻辑。
   - 如果重启类型为`ssl`且服务是`nginx`，则执行`nginx`的升级操作。
   - 对于其他服务，脚本首先尝试重新加载服务（如适用）。如果不适用或重新加载失败，则尝试重置服务失败状态并重启服务。

6. **错误处理**：如果服务重启失败，脚本将记录错误结果，并通过`v-log-action`函数记录一条系统日志，指示服务重启失败。

7. **日志记录**：如果服务成功重启，脚本也会通过`v-log-action`函数记录一条系统日志，指示服务已成功重启。

### 注意事项

- **权限要求**：运行此脚本通常需要root权限，因为重启系统服务通常需要管理员权限。

- **服务类型**：脚本能够处理多种类型的服务，但具体的重启逻辑可能因服务类型而异。对于某些服务，脚本可能包含特定的重启规则或步骤。

- **错误处理**：脚本包含基本的错误处理逻辑，能够记录服务重启失败的情况，并通过系统日志提供错误信息。但是，它可能无法处理所有可能的错误情况。

- **调试模式**：通过设置`DEBUG_MODE`为`true`，您可以启用调试模式，这将导致脚本将更详细的日志记录到`/var/log/hestia/debug.log`文件中。这有助于排查问题。

### 总结

`v-restart-service` 脚本是Hestia控制面板中用于重启系统服务的重要工具。通过指定服务名称和可选的重启类型，脚本能够灵活地处理各种服务重启场景。它包含特定的逻辑来处理不同类型的服务，并提供错误处理和日志记录机制，以便跟踪服务状态和操作结果。在使用此脚本时，请确保了解要重启的服务的配置和依赖关系，并根据实际需求进行操作。

## v-repair-sys-config

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-repair-sys-config)

### 功能描述

`v-repair-sys-config` 是一个用于修复或恢复Hestia控制面板的系统配置文件的CLI（命令行界面）脚本。通过指定不同的模式参数，用户可以执行不同的操作来维护系统配置的健康状态。

### 使用方法

```bash
v-repair-sys-config MODE
```

其中：

- `MODE`：指定要执行的操作模式，可以是`restore`或`repair`。

### 操作模式

- **restore**：恢复系统配置到默认状态或备份状态。
- **repair**：尝试修复当前的系统配置问题。

### 示例

#### 示例 1：恢复系统配置

```bash
v-repair-sys-config restore
```

这个命令将执行`syshealth_restore_system_config`函数，用于恢复系统配置到默认状态或某个备份状态。这通常用于在配置损坏或需要重置到初始状态时。

#### 示例 2：修复系统配置

```bash
v-repair-sys-config repair
```

这个命令将加载配置文件并执行`syshealth_repair_system_config`函数，尝试修复当前的系统配置问题。这可能包括检查配置文件的完整性、修复语法错误或恢复缺失的配置项。

### 脚本执行流程

1. **参数检查**：脚本首先检查传入的`mode`参数是否有效（即`restore`或`repair`）。

2. **加载配置与函数库**：加载Hestia的配置文件和主函数库，以获取必要的配置信息和函数支持。

3. **执行操作**：
   - 如果`mode`为`restore`，则调用`syshealth_restore_system_config`函数来恢复系统配置。
   - 如果`mode`为`repair`，则加载配置文件并调用`syshealth_repair_system_config`函数来尝试修复系统配置。

4. **日志记录**：无论操作是否成功，脚本都会通过`$BIN/v-log-action`记录一条系统日志，表明执行了相应的操作。

5. **事件记录**：使用`log_event`函数记录事件结果，通常是成功或失败的状态。

### 注意事项

- **权限要求**：执行此脚本通常需要具有相应的系统权限，因为修复或恢复系统配置可能涉及对系统文件的修改。

- **备份**：在执行恢复操作之前，建议备份当前的配置文件，以防万一需要回滚到之前的状态。

- **配置检查**：在执行修复操作之前，建议仔细检查和诊断配置问题，确保修复操作能够解决实际问题。

- **错误处理**：脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果和日志输出，以便及时发现并处理任何潜在问题。

### 总结

`v-repair-sys-config` 脚本为Hestia控制面板提供了修复和恢复系统配置的功能。通过指定不同的操作模式，用户可以灵活地处理配置问题，确保系统的稳定性和可靠性。在使用此脚本时，请确保理解操作的含义和潜在影响，并遵循最佳实践进行操作。

## v-refresh-sys-theme

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-refresh-sys-theme)

### 功能描述

`v-refresh-sys-theme` 是一个用于刷新或重新生成当前激活的系统主题的Hestia控制面板CLI（命令行界面）脚本。在某些情况下，如果系统主题缓存出现问题，使用此脚本可以强制系统重新加载和应用主题，解决潜在的显示问题。

### 使用方法

```bash
v-refresh-sys-theme
```

此脚本没有额外的选项或参数，它直接作用于当前激活的系统主题。

### 示例

#### 示例 1：刷新当前系统主题

```bash
v-refresh-sys-theme
```

执行上述命令后，脚本将首先获取当前激活的主题名称，然后强制将主题更改为默认的`default`主题，接着立即将主题切换回原始的主题。这个过程会触发系统重新加载和应用主题，从而解决可能存在的缓存问题。

### 脚本执行流程

1. **加载配置与函数库**：脚本首先加载Hestia的配置文件和主函数库，以获取必要的配置信息和函数支持。

2. **获取当前主题**：脚本读取当前激活的系统主题名称，并将其存储在`CURRENT_THEME`变量中。

3. **切换至默认主题**：使用`$BIN/v-change-sys-theme`命令将系统主题更改为默认的`default`主题。这一步是为了确保系统能够识别并加载新的主题配置。

4. **切换回原始主题**：再次使用`$BIN/v-change-sys-theme`命令将系统主题切换回之前存储的`CURRENT_THEME`。这一步骤是刷新的关键，因为它会触发系统重新加载和应用原始主题的配置文件。

### 注意事项

- **权限要求**：执行此脚本通常需要具有相应的系统权限，因为更改系统主题可能涉及对系统文件和配置的修改。

- **主题缓存**：在大多数情况下，系统主题应该能够自动加载和更新。然而，在某些特定情况下（如缓存问题、配置错误等），使用此脚本可以帮助解决显示不一致或主题不加载的问题。

- **错误处理**：尽管脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果，并根据需要采取进一步的行动。

### 总结

`v-refresh-sys-theme` 脚本为Hestia控制面板提供了刷新系统主题的功能，帮助解决主题缓存或配置问题。通过强制系统重新加载和应用主题，用户可以确保系统的显示和界面保持最新和一致。在使用此脚本时，请确保理解其工作原理，并遵循最佳实践进行操作。

## v-rebuild-user

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-rebuild-user)

### 功能描述

`v-rebuild-user` 是一个Hestia控制面板的CLI（命令行界面）脚本，用于重建特定用户的配置文件和统计信息。当用户的配置出现问题或需要更新时，可以使用此脚本来重置和更新用户的账户设置和统计数据。

### 使用方法

```bash
v-rebuild-user USER [RESTART]
```

- `USER`：要重建配置的用户名。
- `RESTART`（可选）：是否在重建后重启相关服务。如果提供此参数，则脚本将尝试重启用户的Web服务器和其他相关服务。

### 示例

#### 示例 1：重建用户配置但不重启服务

```bash
v-rebuild-user john_doe
```

这个命令将重建`john_doe`用户的配置文件和统计信息，但不会尝试重启任何服务。

#### 示例 2：重建用户配置并重启服务

```bash
v-rebuild-user jane_smith restart
```

这个命令不仅重建`jane_smith`用户的配置文件和统计信息，还会在重建完成后尝试重启该用户的Web服务器和其他相关服务。

### 脚本执行流程

1. **参数检查**：脚本首先检查是否提供了必要的参数，并验证参数的有效性。

2. **加载配置与函数库**：加载Hestia的配置文件和一系列功能函数库，以获取必要的配置信息和函数支持。

3. **用户状态检查**：检查指定用户是否已暂停或存在其他状态问题，如果是，则脚本退出。

4. **只读模式检查**：检查Hestia是否处于只读模式（例如演示模式），如果是，则阻止重建操作。

5. **更新磁盘配额**：如果启用了磁盘配额管理，则更新指定用户的磁盘配额信息。

6. **更新资源限制**：如果启用了资源限制管理，则更新指定用户的cgroup配置。

7. **重建用户配置**：调用`rebuild_user_conf`函数来重建用户的配置文件。

8. **更新用户计数器**：更新用户的计数器信息，例如网站数量、数据库数量等。

9. **更新账户使用统计**：更新用户的账户使用统计信息，如磁盘使用情况、带宽使用情况等。

10. **日志记录**：记录一条系统日志，表明已为用户重建了配置文件。

11. **事件记录**：使用`log_event`函数记录事件结果，通常是成功或失败的状态。

### 注意事项

- **权限要求**：执行此脚本通常需要具有相应的系统权限，因为重建用户配置可能涉及对系统文件和数据库的修改。

- **服务重启**：如果提供了`RESTART`参数，脚本将尝试重启用户的Web服务器和其他相关服务。这可能会导致短暂的服务中断，因此建议在低峰时段执行此操作。

- **数据备份**：在执行重建操作之前，建议备份相关的用户数据和配置文件，以防万一需要回滚到之前的状态。

- **错误处理**：脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果和日志输出，以便及时发现并处理任何潜在问题。

### 总结

`v-rebuild-user` 脚本为Hestia控制面板提供了重建用户配置和统计信息的功能。通过此脚本，管理员可以方便地重置和更新用户的账户设置，解决配置问题或更新统计数据。在使用此脚本时，请确保理解其工作原理，并遵循最佳实践进行操作。

## v-rebuild-users

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-rebuild-users)

### 功能描述

`v-rebuild-users` 是一个Hestia控制面板的CLI（命令行界面）脚本，用于重建所有用户的配置文件和统计信息。当需要批量重置和更新多个用户的账户设置和统计数据时，可以使用此脚本来实现。

### 使用方法

```bash
v-rebuild-users [RESTART]
```

- `RESTART`（可选）：是否在重建后重启相关服务。如果提供此参数，则脚本将为每个用户尝试重启Web服务器和其他相关服务。

### 示例

#### 示例 1：重建所有用户配置但不重启服务

```bash
v-rebuild-users
```

这个命令将遍历所有用户，并为每个用户重建配置文件和统计信息，但不会尝试重启任何服务。

#### 示例 2：重建所有用户配置并重启服务

```bash
v-rebuild-users restart
```

这个命令除了重建所有用户的配置文件和统计信息外，还会在重建完成后尝试为每个用户的Web服务器和其他相关服务进行重启。

### 脚本执行流程

1. **参数检查**：脚本首先检查是否提供了可选的`RESTART`参数。

2. **加载配置与函数库**：加载Hestia的配置文件和一系列功能函数库，以获取必要的配置信息和函数支持。

3. **只读模式检查**：检查Hestia是否处于只读模式（例如演示模式），如果是，则阻止重建操作。

4. **用户列表获取**：使用`v-list-users`命令获取所有用户的列表。

5. **重建循环**：对于获取到的每个用户，调用`v-rebuild-user`命令来重建该用户的配置文件和统计信息。

6. **日志记录**：记录一条事件日志，表示已经完成了对所有用户的配置文件重建操作。

7. **脚本退出**：脚本执行完毕后正常退出。

### 注意事项

- **权限要求**：执行此脚本通常需要具有相应的系统权限，因为重建用户配置可能涉及对系统文件和数据库的修改。

- **服务重启**：如果提供了`RESTART`参数，脚本将为每个用户尝试重启Web服务器和其他相关服务。这可能会导致短暂的服务中断，因此建议在低峰时段执行此操作。

- **数据备份**：在执行重建操作之前，建议备份相关的用户数据和配置文件，以防万一需要回滚到之前的状态。

- **错误处理**：脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果和日志输出，以便及时发现并处理任何潜在问题。

### 总结

`v-rebuild-users` 脚本为Hestia控制面板提供了重建所有用户配置和统计信息的功能。通过此脚本，管理员可以方便地批量重置和更新多个用户的账户设置，解决配置问题或更新统计数据。在使用此脚本时，请确保理解其工作原理，并遵循最佳实践进行操作。

## v-list-sys-themes

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-themes)

### 功能描述

`v-list-sys-themes` 是一个Hestia控制面板的CLI（命令行界面）脚本，用于列出系统中所有可用的系统主题。该脚本将搜索指定目录中的CSS文件，并将文件名（不含扩展名）作为可用的主题名称列出。用户可以通过指定不同的输出格式（如JSON、纯文本、CSV或Shell格式）来定制输出。

### 使用方法

```bash
v-list-sys-themes [FORMAT]
```

- `FORMAT`（可选）：指定输出格式。如果不提供，则默认为`shell`格式。可选的格式包括`json`、`plain`、`csv`和`shell`。

### 示例

#### 示例 1：列出所有可用主题（Shell格式）

```bash
v-list-sys-themes
```

输出示例：

```
THEME
-----
theme1
theme2
theme3
...
```

#### 示例 2：列出所有可用主题（JSON格式）

```bash
v-list-sys-themes json
```

输出示例：

```json
[
    "theme1",
    "theme2",
    "theme3",
    ...
]
```

#### 示例 3：列出所有可用主题（纯文本格式）

```bash
v-list-sys-themes plain
```

输出示例：

```
theme1
theme2
theme3
...
```

#### 示例 4：列出所有可用主题（CSV格式）

```bash
v-list-sys-themes csv
```

输出示例：

```
THEME
theme1
theme2
theme3
...
```

### 脚本执行流程

1. **参数处理**：脚本首先检查是否提供了输出格式参数`$format`，如果没有提供，则默认为`shell`格式。

2. **配置加载**：加载Hestia的配置文件和主要的功能函数库。

3. **配置解析**：解析配置文件，获取主题目录的路径。

4. **主题收集**：搜索系统主题目录`$HESTIA_THEMES`下的`.min.css`文件，并将文件名（不含`.min.css`扩展名）添加到`available_themes`数组中。同时，也检查自定义主题目录`$HESTIA_THEMES_CUSTOM`下的`.css`文件，并将相应的文件名添加到数组中。

5. **主题排序**：对收集到的主题名称进行排序。

6. **输出格式选择**：根据提供的输出格式参数，调用相应的函数来格式化输出。

7. **输出列表**：将格式化后的主题列表输出到标准输出。

8. **脚本退出**：脚本执行完毕后正常退出。

### 注意事项

- **权限要求**：执行此脚本通常需要具有读取主题目录的权限。

- **目录结构**：确保指定的主题目录结构正确，并且包含正确的CSS文件。

- **自定义主题**：自定义主题应放置在`$HESTIA_THEMES_CUSTOM`目录下，并且使用`.css`作为文件扩展名。

- **错误处理**：脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果，以确保正确列出所有可用的主题。

### 总结

`v-list-sys-themes` 脚本为Hestia控制面板提供了列出系统中所有可用系统主题的功能。通过该脚本，用户可以方便地查看和管理主题，以便在需要时选择合适的主题进行应用。用户可以根据需要选择不同的输出格式来定制输出，以适应不同的使用场景。

## v-list-sys-users

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-users)

### 功能描述

`v-list-sys-users` 是一个Hestia控制面板的CLI（命令行界面）脚本，用于列出系统中的所有用户。该脚本通过调用`v-list-users`命令并处理其输出来获取用户列表。用户可以选择不同的输出格式（如JSON、纯文本、CSV或Shell格式）来定制输出。

### 使用方法

```bash
v-list-sys-users [FORMAT]
```

- `FORMAT`（可选）：指定输出格式。如果不提供，则默认为`shell`格式。可选的格式包括`json`、`plain`、`csv`和`shell`。

### 示例

#### 示例 1：列出所有用户（Shell格式）

```bash
v-list-sys-users shell
```

输出示例：

```bash
USER
----
user1
user2
user3
...
```

#### 示例 2：列出所有用户（JSON格式）

```bash
v-list-sys-users json
```

输出示例：

```json
[
    "user1",
    "user2",
    "user3",
    ...
]
```

#### 示例 3：列出所有用户（纯文本格式）

```bash
v-list-sys-users plain
```

输出示例：

```bash
user1
user2
user3
...
```

#### 示例 4：列出所有用户（CSV格式）

```bash
v-list-sys-users csv
```

输出示例：

```bash
USER
user1
user2
user3
...
```

### 脚本执行流程

1. **参数处理**：脚本首先检查是否提供了输出格式参数`$format`，如果没有提供，则默认为`shell`格式。

2. **配置加载**：加载Hestia的配置文件和主要的功能函数库。

3. **执行子命令**：调用`v-list-users`命令，并传递参数`'list'`来获取用户列表。

4. **输出格式选择**：根据提供的输出格式参数，调用相应的函数来格式化输出。

   - `json_list`：将用户列表格式化为JSON数组。
   - `shell_list`：将用户列表格式化为Shell友好的表格。
   - `plain_list`：简单地逐行输出用户列表。
   - `csv_list`：将用户列表格式化为CSV格式。

5. **输出列表**：将格式化后的用户列表输出到标准输出。

6. **脚本退出**：脚本执行完毕后正常退出。

### 注意事项

- **权限要求**：执行此脚本通常需要具有足够的权限来访问用户列表。

- **依赖命令**：脚本依赖于`v-list-users`命令的正确执行和输出。确保该命令可用且按预期工作。

- **错误处理**：脚本包含基本的错误处理逻辑，但用户仍应关注脚本的执行结果，以确保正确列出所有用户。

### 总结

`v-list-sys-users` 脚本为Hestia控制面板提供了列出系统中所有用户的功能。通过该脚本，用户可以方便地查看和管理系统中的用户列表。用户可以根据需要选择不同的输出格式来定制输出，以适应不同的使用场景。

## v-list-sys-network-status

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-network-status)

### 命令概述

`v-list-sys-network-status` 是一个Hestia系统管理工具中的CLI命令，用于列出系统的网络状态信息。通过执行此命令，用户可以获取有关网络统计、网络使用情况和网络接口的详细信息。

### 命令语法

```bash
v-list-sys-network-status
```

### 选项

此命令不需要任何选项即可执行。

### 示例

#### 示例1：基本用法

执行`v-list-sys-network-status`命令，获取网络状态信息：

```bash
$ v-list-sys-network-status
```

输出可能包含以下部分：

- 网络统计信息，包括TCP连接数、UDP连接数等。
- 网络使用情况，列出了当前正在使用的网络套接字及其相关信息。
- 网络接口列表，显示了系统上所有网络接口的配置和状态。

#### 示例2：详细输出

如果需要更详细的输出，可以将命令的输出重定向到文件或管道到其他工具进行处理。例如，将输出保存到文件中：

```bash
$ v-list-sys-network-status > network_status.txt
```

然后，可以使用文本编辑器或`cat`命令查看`network_status.txt`文件的内容。

### 注意事项

- 执行此命令可能需要具有适当的系统权限。
- 根据系统配置和网络环境的不同，输出内容可能会有所不同。
- 输出的格式和内容可能会随着Hestia工具的更新而发生变化。

### 功能说明

该命令通过调用系统命令`ss -s`来显示网络统计信息，使用`lsof -iudp -itcp -n -P`来列出网络使用情况，并通过`ip addr list`命令显示网络接口详情。这些命令的输出被格式化并分隔开，以便用户能够清晰地查看和理解各种网络状态信息。

### 总结

`v-list-sys-network-status`是一个实用的Hestia CLI命令，用于快速获取系统的网络状态信息。用户可以通过执行此命令来监控网络使用情况、检查网络接口状态以及获取其他有用的网络统计数据。

## v-list-sys-memory-status

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-memory-status)

### 命令概述

`v-list-sys-memory-status` 是Hestia系统中用于列出系统内存状态的CLI命令。该命令通过调用不同的系统命令和工具来提供关于虚拟内存、内存统计以及RAM信息的详细报告。

### 命令语法

```bash
v-list-sys-memory-status
```

该命令无需任何参数，直接执行即可获取系统内存状态的相关信息。

### 示例

#### 示例1：查看虚拟内存信息

执行`v-list-sys-memory-status`命令后，首先会调用`free`命令来显示虚拟内存的使用情况。输出可能如下：

```
             total        used        free      shared  buff/cache   available
Mem:           7964        1636        4060         306        2267        5891
Swap:          2047           0        2047
Total:        10011        1636        6107
```

该输出显示了系统的总内存、已使用内存、空闲内存、共享内存、缓存/缓冲区内存以及可用内存的信息。

#### 示例2：查看内存统计信息

接下来，命令会调用`vmstat`命令来提供内存统计信息。输出可能如下：

```
       1047520 K total memory
       1013248 K used memory
        20724 K active memory
       317088 K inactive memory
       334440 K active(anon) memory
        50020 K active(file) memory
       280208 K inactive(anon) memory
        36880 K inactive(file) memory
       103600 K unevictable memory
           0 K mlocked memory
       340776 K swap cache
            0 K total swap
            0 K used swap
            0 K free swap
        39112 non-shared ram
       987272 K shared ram
      1024000 K total high
            0 K total low
        20724 K free pages
       132260 K reserved pages
        33744 K slab reclaimable pages
        27004 K kernel stack pages
        21616 K pagetables pages
            0 K bounce pages
            0 K free_pcpages
            0 K local_pcpages
            0 K dma pages
       720896 K fs_cache
            0 K fs_cache_anon
        34076 K fs_cache_wback
            0 K fs_cache_cong_threshold
        10240 K anon_pages
       290572 K mapped_file
        12644 K shmem
        37612 K kstack
        33744 K stack
```

该输出提供了关于内存使用的详细统计信息，包括总内存、已使用内存、活动内存、非活动内存、交换缓存等。

#### 示例3：查看RAM信息

最后，命令会调用`dmidecode`命令来显示RAM的详细信息。输出可能如下：

```
Handle 0x0004, DMI type 17, 27 bytes
Memory Device
        Array Handle: 0x0003
        Error Information Handle: Not Provided
        Total Width: 64 bits
        Data Width: 64 bits
        Size: 8192 MB
        Form Factor: DIMM
        Set: None
        Locator: DIMM 0
        Bank Locator: Not Specified
        Type: DDR4
        Type Detail: Synchronous
        Speed: 2400 MT/s
        Manufacturer: Manufacturer01
        Serial Number: Serial1
        Asset Tag: AssetTagNum1
        Part Number: PartNum1
```

该输出提供了关于RAM设备的详细信息，包括总宽度、数据宽度、大小、外形因子、制造商、序列号等。

### 注意事项

- 在执行命令时，确保已经正确配置了Hestia系统，并且具有足够的权限来执行该命令。
- 由于`dmidecode`命令可能需要root权限才能获取完整的RAM信息，因此在实际环境中可能需要使用sudo或以root用户身份执行该命令。

### 功能说明

`v-list-sys-memory-status` 命令通过调用不同的系统命令和工具来获取和

## v-list-sys-info

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-info)

### 命令概述

`v-list-sys-info` 是Hestia系统中用于列出系统信息的CLI命令。该命令通过调用系统命令和读取配置文件，收集并展示包括主机名、操作系统、版本、架构、Hestia版本、发布分支、系统运行时间以及负载平均值等在内的系统相关信息。

### 命令语法

```bash
v-list-sys-info [format]
```

其中，`[format]` 是一个可选参数，用于指定输出格式。如果不提供该参数，默认使用 `shell` 格式。支持的格式包括：

- `json`：以JSON格式输出系统信息。
- `shell`：以易读的表格形式输出系统信息（默认值）。
- `plain`：以制表符分隔的文本形式输出系统信息。
- `csv`：以逗号分隔的文本形式输出系统信息，适用于导入电子表格软件。

### 示例

#### 示例1：使用默认shell格式输出系统信息

执行命令：

```bash
v-list-sys-info
```

输出可能如下：

```
HOSTNAME   OS      VERSION  ARCH    HESTIA      RELEASE   UPTIME   LA
--------   --      ---      ----    ------      -------   ------   --
myhost     CentOS    7.9.2009 x86_64  hestia-1.2  stable    12345    0.15
```

该输出以表格形式展示了包括主机名、操作系统、版本、架构、Hestia版本、发布分支、系统运行时间以及负载平均值等在内的系统信息。

#### 示例2：使用json格式输出系统信息

执行命令：

```bash
v-list-sys-info json
```

输出可能如下：

```json
{
    "sysinfo": {
        "HOSTNAME": "myhost",
        "OS": "CentOS",
        "VERSION": "7.9.2009",
        "ARCH": "x86_64",
        "HESTIA": "hestia-1.2",
        "RELEASE": "stable",
        "UPTIME": "12345",
        "LOADAVERAGE": "0.15"
    }
}
```

该输出以JSON格式展示了相同的系统信息，方便解析和处理。

#### 示例3：使用plain格式输出系统信息

执行命令：

```bash
v-list-sys-info plain
```

输出可能如下：

```
myhost	CentOS	7.9.2009	x86_64	hestia-1.2	stable	12345	0.15
```

该输出以制表符分隔的文本形式展示了系统信息，适合在脚本或命令行工具中进行进一步处理。

#### 示例4：使用csv格式输出系统信息

执行命令：

```bash
v-list-sys-info csv
```

输出可能如下：

```
HOSTNAME,OS,VERSION,ARCH,HESTIA,RELEASE,UPTIME,LOADAVERAGE
myhost,CentOS,7.9.2009,x86_64,hestia-1.2,stable,12345,0.15
```

该输出以逗号分隔的文本形式展示了系统信息，可以直接导入电子表格软件中进行进一步分析。

### 注意事项

- 在执行命令时，确保已经正确配置了Hestia系统，并且具有足够的权限来执行该命令。
- 由于命令需要读取系统配置文件和调用系统命令，因此在实际环境中可能需要根据具体环境进行适当的调整或配置。

### 功能说明

`v-list-sys-info` 命令通过读取Hestia的配置文件，获取Hestia的版本和发布分支信息，并结合系统命令和配置文件，收集其他系统信息。命令提供了多种输出格式，以满足不同场景下的需求。该命令在Hestia系统中用于快速获取系统的基本信息，方便用户了解和管理系统状态。

## v-list-sys-interfaces

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-interfaces)

### 命令概述

`v-list-sys-interfaces` 是Hestia系统中的一个CLI命令，用于列出系统中的网络接口。该命令通过读取系统网络接口信息，并以不同的格式输出，方便用户查看和管理系统网络接口。

### 命令语法

```bash
v-list-sys-interfaces [format]
```

其中，`[format]` 是一个可选参数，用于指定输出格式。如果不提供该参数，默认使用 `shell` 格式。支持的格式包括：

- `json`：以JSON格式输出网络接口列表。
- `shell`：以易读的表格形式输出网络接口列表（默认值）。
- `plain`：以纯文本形式输出网络接口列表，每行一个接口。
- `csv`：以逗号分隔的文本形式输出网络接口列表，适用于导入电子表格软件。

### 示例

#### 示例1：使用默认shell格式输出网络接口列表

执行命令：

```bash
v-list-sys-interfaces
```

输出可能如下：

```
INTERFACE
---------
eth0
eth1
wlan0
```

该输出以表格形式展示了系统中的网络接口列表。

#### 示例2：使用json格式输出网络接口列表

执行命令：

```bash
v-list-sys-interfaces json
```

输出可能如下：

```json
[
    "eth0",
    "eth1",
    "wlan0"
]
```

该输出以JSON格式展示了相同的网络接口列表，方便解析和处理。

#### 示例3：使用plain格式输出网络接口列表

执行命令：

```bash
v-list-sys-interfaces plain
```

输出可能如下：

```
eth0
eth1
wlan0
```

该输出以纯文本形式展示了网络接口列表，每行一个接口。

#### 示例4：使用csv格式输出网络接口列表

执行命令：

```bash
v-list-sys-interfaces csv
```

输出可能如下：

```
INTERFACE
eth0
eth1
wlan0
```

该输出以逗号分隔的文本形式展示了网络接口列表，可以直接导入电子表格软件中进行进一步分析。

### 注意事项

- 在执行命令时，确保已经正确配置了Hestia系统，并且具有足够的权限来执行该命令。
- 命令的输出结果可能因系统环境和配置的不同而有所差异。

### 功能说明

`v-list-sys-interfaces` 命令通过调用系统命令（如 `ip` 命令）来获取网络接口信息，并提取物理网络接口列表。然后，根据用户指定的输出格式，使用不同的函数进行格式化输出。该命令在Hestia系统中用于快速查看系统中的网络接口情况，方便用户进行网络配置和管理。

## v-list-sys-config

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-config)

### 命令概述

`v-list-sys-config` 是Hestia系统中一个用于列出系统配置信息的CLI命令。该命令读取Hestia的配置文件，提取重要的配置项，并以指定的格式输出给用户。通过该命令，用户可以快速查看和验证系统配置，以便进行管理和调试。

### 命令语法

```bash
v-list-sys-config [format]
```

其中，`[format]` 是一个可选参数，用于指定输出格式。如果不提供该参数，默认使用 `shell` 格式。支持的格式包括：

- `json`：以JSON格式输出配置信息。
- `shell`：以易读的表格形式输出配置信息（默认值）。

### 示例

#### 示例1：使用默认shell格式输出系统配置信息

执行命令：

```bash
v-list-sys-config
```

输出可能如下：

```
配置项名称              配置项值
------------------------  -----------
ANTISPAM_SYSTEM       启用
ANTIVIRUS_SYSTEM      启用
API                   启用
API_ALLOWED_IP        192.168.1.0/24
API_SYSTEM            启用
APP_NAME              HestiaCP
BACKEND_PORT          8080
BACKUP                启用
BACKUP_GZIP           禁用
BACKUP_MODE           每日
BACKUP_SYSTEM        启用
CRON_SYSTEM           启用
...
```

该输出以表格形式展示了系统中的多个配置项及其对应的值，方便用户查看和验证。

#### 示例2：使用json格式输出系统配置信息

执行命令：

```bash
v-list-sys-config json
```

输出可能如下：

```json
{
  "config": {
    "ANTISPAM_SYSTEM": "启用",
    "ANTIVIRUS_SYSTEM": "启用",
    "API": "启用",
    "API_ALLOWED_IP": "192.168.1.0/24",
    "API_SYSTEM": "启用",
    "APP_NAME": "HestiaCP",
    "BACKEND_PORT": "8080",
    "BACKUP": "启用",
    "BACKUP_GZIP": "禁用",
    "BACKUP_MODE": "每日",
    "BACKUP_SYSTEM": "启用",
    "CRON_SYSTEM": "启用",
    ...
  }
}
```

该输出以JSON格式展示了相同的配置信息，方便解析和处理。

### 注意事项

- 在执行命令时，确保已经正确配置了Hestia系统，并且具有足够的权限来执行该命令。
- 命令的输出结果可能因系统环境和配置的不同而有所差异。

### 功能说明

`v-list-sys-config` 命令通过读取Hestia的配置文件，提取出重要的配置项，并根据用户指定的输出格式进行格式化输出。这对于系统管理员和开发者来说非常有用，可以快速查看和验证系统的配置情况，以便进行进一步的配置调整或故障排查。

在实际应用中，系统管理员可以通过该命令来确认是否启用了特定的功能（如反垃圾邮件系统、API等），或者查看特定配置项的值（如后端端口、备份模式等）。这对于系统的日常管理和维护至关重要。

同时，开发者也可以利用该命令在开发或调试过程中快速检查系统的配置状态，确保代码能够正确地读取和处理配置项。

## v-list-sys-cpu-status

* [命令行Bash 脚本查看](https://hestiamb.org/bin/v-list-sys-cpu-status)

### 命令概述

`v-list-sys-cpu-status` 是Hestia系统中的一个CLI命令，用于列出系统CPU的详细信息。该命令通过执行多个系统命令并提取关键信息，为用户提供关于CPU型号、架构、核心数、线程数等关键参数的概览。这对于系统管理员和开发者在管理和调试系统时非常有用。

### 命令使用

执行该命令非常简单，只需要在终端中输入以下命令：

```bash
v-list-sys-cpu-status
```

执行后，命令会输出系统CPU的详细信息。

### 示例输出

#### 示例1：命令输出

```bash
# 以下是top命令的输出，显示CPU使用情况的前30行
top - 10:23:45 up 2 days, 17:30,  1 user,  load average: 0.05, 0.08, 0.11
Tasks: 123 total,   1 running, 122 sleeping,   0 stopped,   0 zombie
%Cpu(s):  1.0 us,  0.5 sy,  0.0 ni, 98.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
MiB Mem :  3955.1 total,  1022.5 free,  1229.3 used,  1703.3 buff/cache
MiB Swap:  2047.0 total,  2047.0 free,    0.0 used.  2460.5 avail Mem 

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
    1 root      20   0  167840  12044   8368 S   0.0  0.3   0:02.25 systemd
    2 root      20   0       0      0      0 S   0.0  0.0   0:00.00 kthreadd
    ...
    ...
```

--------------------------------------------------------------------------------------

### 以下是pstree命令的输出，显示进程树

```bash
systemd─┬─(sd-pam)
         ├─(sd-pam)
         ├─sshd───sshd───bash───v-list-sys-cpu-status───top
         ├─sshd───sshd───bash───pstree
         ...
         ...
------------------------------------------------------------------------------------------

# 以下是grep和lscpu命令的输出，显示CPU型号和详细信息
model name      : Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz
Architecture:        x86_64
CPU op-mode(s):      32-bit, 64-bit
Byte Order:          Little Endian
CPU(s):              6
On-line CPU(s) list: 0-5
Thread(s) per core:  2
Core(s) per socket:  3
Socket(s):           1
NUMA node(s):      1
Vendor ID:           GenuineIntel
CPU family:          6
Model:               158
Model name:          Intel(R) Core(TM) i7-8700K CPU @ 3.70GHz
Stepping:            10
CPU MHz:             800.024
CPU max MHz:         4700.0000
CPU min MHz:         800.0000
BogoMIPS:            7400.00
Virtualization:      VT-x
L1d cache:           32K
L1i cache:           32K
L2 cache:            256K
L3 cache:            12288K
NUMA node0 CPU(s):   0-5
Flags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_capables pebs bts rep_good nopl xtopology nonstop_tsc cpuid aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid sse
```

### 命令输出解析

### CPU使用率

在`top`命令的输出中，我们首先看到的是系统的总体运行信息，包括系统运行时间、登录用户数量、系统负载平均值等。接下来是任务列表，列出了当前运行的进程及其CPU使用率、内存占用等信息。这对于快速识别资源消耗大的进程非常有用。

### 进程树

`pstree`命令以树状图的方式显示了当前系统的进程结构。这有助于我们理解各个进程之间的关系，以及它们是如何相互依赖和协作的。

### CPU详细信息

通过`grep`和`lscpu`命令，我们可以获取到CPU的型号、架构、核心数、线程数等详细信息。这些信息对于系统管理员在配置和优化系统性能时至关重要。

### 注意事项

- `v-list-sys-cpu-status`命令依赖于`top`、`pstree`和`lscpu`等系统命令，因此确保这些命令在系统上可用。
- 由于`top`命令的输出是动态的，每次执行可能都会有所不同，因此输出内容可能有所差异。
- 输出的信息可能会随着系统的不同配置和状态而有所变化，例如CPU的核心数、线程数等。

### 使用场景

- 当需要查看当前系统的CPU使用情况时，可以使用该命令快速获取相关信息。
- 在进行系统性能调优或故障排查时，该命令可以提供关于CPU的详细信息，帮助定位问题所在。
- 对于系统管理员和开发者来说，了解系统的CPU配置和性能特点是非常重要的，该命令可以作为一个快速获取这些信息的工具。

### 总结

`v-list-sys-cpu-status`命令是一个实用的CLI工具，用于列出系统CPU的详细信息。通过执行该命令，用户可以快速获取关于CPU使用率、进程树和CPU配置等方面的信息，从而更好地管理和优化系统性能。